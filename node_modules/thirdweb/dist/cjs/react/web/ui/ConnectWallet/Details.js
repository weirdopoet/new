"use strict";
"use client";
Object.defineProperty(exports, "__esModule", { value: true });
exports.StyledChevronRightIcon = exports.ConnectedWalletDetails = void 0;
exports.detailsBtn_formatFiatBalanceForButton = detailsBtn_formatFiatBalanceForButton;
exports.detailsBtn_formatTokenBalanceForButton = detailsBtn_formatTokenBalanceForButton;
exports.DetailsModal = DetailsModal;
exports.NetworkSwitcherButton = NetworkSwitcherButton;
exports.ConnectedToSmartWallet = ConnectedToSmartWallet;
exports.InAppWalletUserInfo = InAppWalletUserInfo;
exports.SwitchNetworkButton = SwitchNetworkButton;
exports.useWalletDetailsModal = useWalletDetailsModal;
const jsx_runtime_1 = require("react/jsx-runtime");
const styled_1 = require("@emotion/styled");
const react_icons_1 = require("@radix-ui/react-icons");
const react_query_1 = require("@tanstack/react-query");
const react_1 = require("react");
const pay_js_1 = require("../../../../analytics/track/pay.js");
const utils_js_1 = require("../../../../chains/utils.js");
const contract_js_1 = require("../../../../contract/contract.js");
const storage_js_1 = require("../../../../react/core/utils/storage.js");
const address_js_1 = require("../../../../utils/address.js");
const is_contract_deployed_js_1 = require("../../../../utils/bytecode/is-contract-deployed.js");
const webStorage_js_1 = require("../../../../utils/storage/webStorage.js");
const is_ecosystem_wallet_js_1 = require("../../../../wallets/ecosystem/is-ecosystem-wallet.js");
const is_smart_wallet_js_1 = require("../../../../wallets/smart/is-smart-wallet.js");
const types_js_1 = require("../../../../wallets/types.js");
const provider_js_1 = require("../../../core/account/provider.js");
const CustomThemeProvider_js_1 = require("../../../core/design-system/CustomThemeProvider.js");
const index_js_1 = require("../../../core/design-system/index.js");
const useChainQuery_js_1 = require("../../../core/hooks/others/useChainQuery.js");
const useActiveAccount_js_1 = require("../../../core/hooks/wallets/useActiveAccount.js");
const useActiveWallet_js_1 = require("../../../core/hooks/wallets/useActiveWallet.js");
const useActiveWalletChain_js_1 = require("../../../core/hooks/wallets/useActiveWalletChain.js");
const useAdminWallet_js_1 = require("../../../core/hooks/wallets/useAdminWallet.js");
const useDisconnect_js_1 = require("../../../core/hooks/wallets/useDisconnect.js");
const useSwitchActiveWalletChain_js_1 = require("../../../core/hooks/wallets/useSwitchActiveWalletChain.js");
const RootElementContext_js_1 = require("../../../core/providers/RootElementContext.js");
const account_js_1 = require("../../../core/utils/account.js");
const wallet_js_1 = require("../../../core/utils/wallet.js");
const wallet_ui_states_provider_js_1 = require("../../providers/wallet-ui-states-provider.js");
const BuyWidget_js_1 = require("../Bridge/BuyWidget.js");
const basic_js_1 = require("../components/basic.js");
const buttons_js_1 = require("../components/buttons.js");
const ChainActiveDot_js_1 = require("../components/ChainActiveDot.js");
const CopyIcon_js_1 = require("../components/CopyIcon.js");
const fallbackChainIcon_js_1 = require("../components/fallbackChainIcon.js");
const IconContainer_js_1 = require("../components/IconContainer.js");
const Modal_js_1 = require("../components/Modal.js");
const Skeleton_js_1 = require("../components/Skeleton.js");
const Spacer_js_1 = require("../components/Spacer.js");
const Spinner_js_1 = require("../components/Spinner.js");
const Tooltip_js_1 = require("../components/Tooltip.js");
const text_js_1 = require("../components/text.js");
const WalletImage_js_1 = require("../components/WalletImage.js");
const animations_js_1 = require("../design-system/animations.js");
const elements_js_1 = require("../design-system/elements.js");
const address_js_2 = require("../prebuilt/Account/address.js");
const avatar_js_1 = require("../prebuilt/Account/avatar.js");
const balance_js_1 = require("../prebuilt/Account/balance.js");
const blobbie_js_1 = require("../prebuilt/Account/blobbie.js");
const name_js_1 = require("../prebuilt/Account/name.js");
const icon_js_1 = require("../prebuilt/Chain/icon.js");
const name_js_2 = require("../prebuilt/Chain/name.js");
const provider_js_2 = require("../prebuilt/Chain/provider.js");
const constants_js_1 = require("./constants.js");
const CoinsIcon_js_1 = require("./icons/CoinsIcon.js");
const FundsIcon_js_1 = require("./icons/FundsIcon.js");
const OutlineWalletIcon_js_1 = require("./icons/OutlineWalletIcon.js");
const getConnectLocale_js_1 = require("./locale/getConnectLocale.js");
const MenuButton_js_1 = require("./MenuButton.js");
const screen_js_1 = require("./Modal/screen.js");
const NetworkSelector_js_1 = require("./NetworkSelector.js");
const WalletManagerScreen_js_1 = require("./screens/Details/WalletManagerScreen.js");
const LinkedProfilesScreen_js_1 = require("./screens/LinkedProfilesScreen.js");
const LinkProfileScreen_js_1 = require("./screens/LinkProfileScreen.js");
const ManageWalletScreen_js_1 = require("./screens/ManageWalletScreen.js");
const PrivateKey_js_1 = require("./screens/PrivateKey.js");
const ReceiveFunds_js_1 = require("./screens/ReceiveFunds.js");
const SendFunds_js_1 = require("./screens/SendFunds.js");
const ViewAssets_js_1 = require("./screens/ViewAssets.js");
const ViewNFTs_js_1 = require("./screens/ViewNFTs.js");
const ViewTokens_js_1 = require("./screens/ViewTokens.js");
const WalletConnectReceiverScreen_js_1 = require("./screens/WalletConnectReceiverScreen.js");
const TransactionsScreen_js_1 = require("./TransactionsScreen.js");
const TW_CONNECTED_WALLET = "tw-connected-wallet";
const LocalhostChainId = 1337;
/**
 * @internal
 */
const ConnectedWalletDetails = (props) => {
    const { connectLocale: locale, client } = props;
    const setRootEl = (0, react_1.useContext)(RootElementContext_js_1.SetRootElementContext);
    const walletChain = (0, useActiveWalletChain_js_1.useActiveWalletChain)();
    function closeModal() {
        setRootEl(null);
    }
    function openModal() {
        setRootEl((0, jsx_runtime_1.jsx)(DetailsModal, { assetTabs: props.detailsModal?.assetTabs, chains: props.chains, client: client, closeModal: closeModal, connectOptions: props.connectOptions, detailsModal: props.detailsModal, displayBalanceToken: props.detailsButton?.displayBalanceToken, locale: locale, onDisconnect: props.onDisconnect, supportedNFTs: props.supportedNFTs, supportedTokens: props.supportedTokens, theme: props.theme, showBalanceInFiat: props.detailsButton?.showBalanceInFiat }));
    }
    const isNetworkMismatch = props.chain && walletChain && walletChain.id !== props.chain.id;
    if (props.detailsButton?.render) {
        return (
        // biome-ignore lint/a11y/useKeyWithClickEvents: ok
        // biome-ignore lint/a11y/noStaticElementInteractions: TODO
        (0, jsx_runtime_1.jsx)("div", { onClick: openModal, children: (0, jsx_runtime_1.jsx)(props.detailsButton.render, {}) }));
    }
    if (props.chain && isNetworkMismatch) {
        return ((0, jsx_runtime_1.jsx)(SwitchNetworkButton, { className: props.switchButton?.className, connectLocale: locale, style: props.switchButton?.style, switchNetworkBtnTitle: props.switchButton?.label, targetChain: props.chain }));
    }
    const combinedClassName = `${TW_CONNECTED_WALLET} ${props.detailsButton?.className || ""}`;
    const tokenAddress = props.detailsButton?.displayBalanceToken?.[Number(walletChain?.id)];
    return ((0, jsx_runtime_1.jsxs)(WalletInfoButton, { className: combinedClassName, "data-test": "connected-wallet-details", onClick: openModal, style: props.detailsButton?.style, type: "button", children: [(0, jsx_runtime_1.jsx)(basic_js_1.Container, { style: {
                    borderRadius: "100%",
                    height: "35px",
                    overflow: "hidden",
                    width: "35px",
                }, children: props.detailsButton?.connectedAccountAvatarUrl ? ((0, jsx_runtime_1.jsx)("img", { alt: "", src: props.detailsButton.connectedAccountAvatarUrl, style: {
                        height: "100%",
                        objectFit: "cover",
                        width: "100%",
                    } })) : ((0, jsx_runtime_1.jsx)(avatar_js_1.AccountAvatar, { className: `${TW_CONNECTED_WALLET}__account_avatar`, fallbackComponent: (0, jsx_runtime_1.jsx)(blobbie_js_1.AccountBlobbie, { className: `${TW_CONNECTED_WALLET}__account_avatar`, size: 35 }), loadingComponent: (0, jsx_runtime_1.jsx)(blobbie_js_1.AccountBlobbie, { className: `${TW_CONNECTED_WALLET}__account_avatar`, size: 35 }), queryOptions: {
                        refetchOnMount: false,
                        refetchOnWindowFocus: false,
                    }, style: {
                        height: "100%",
                        objectFit: "cover",
                        width: "100%",
                    } })) }), (0, jsx_runtime_1.jsxs)(basic_js_1.Container, { flex: "column", gap: "4xs", style: {
                    borderRadius: `0 ${index_js_1.radius.md} ${index_js_1.radius.md} 0`,
                    textOverflow: "ellipsis",
                    whiteSpace: "nowrap",
                }, children: [props.detailsButton?.connectedAccountName ? ((0, jsx_runtime_1.jsx)(text_js_1.Text, { className: `${TW_CONNECTED_WALLET}__address`, color: "primaryText", size: "xs", weight: 500, children: props.detailsButton.connectedAccountName })) : ((0, jsx_runtime_1.jsx)(text_js_1.Text, { className: `${TW_CONNECTED_WALLET}__address`, color: "primaryText", size: "xs", weight: 500, children: (0, jsx_runtime_1.jsx)(name_js_1.AccountName, { fallbackComponent: (0, jsx_runtime_1.jsx)(address_js_2.AccountAddress, { formatFn: address_js_1.shortenAddress }), loadingComponent: (0, jsx_runtime_1.jsx)(address_js_2.AccountAddress, { formatFn: address_js_1.shortenAddress }) }) })), (0, jsx_runtime_1.jsx)(text_js_1.Text, { className: `${TW_CONNECTED_WALLET}__balance`, color: "secondaryText", size: "xs", style: {
                            alignItems: "center",
                            display: "flex",
                            gap: "2px",
                        }, weight: 400, children: props.detailsButton?.showBalanceInFiat ? ((0, jsx_runtime_1.jsxs)(jsx_runtime_1.Fragment, { children: [(0, jsx_runtime_1.jsx)(balance_js_1.AccountBalance, { chain: walletChain, fallbackComponent: (0, jsx_runtime_1.jsx)(Skeleton_js_1.Skeleton, { height: index_js_1.fontSize.xs, width: "50px" }), loadingComponent: (0, jsx_runtime_1.jsx)(Skeleton_js_1.Skeleton, { height: index_js_1.fontSize.xs, width: "50px" }), tokenAddress: tokenAddress }), (0, jsx_runtime_1.jsx)(balance_js_1.AccountBalance, { chain: walletChain, formatFn: detailsBtn_formatFiatBalanceForButton, loadingComponent: (0, jsx_runtime_1.jsx)(Skeleton_js_1.Skeleton, { height: index_js_1.fontSize.xs, width: "20px" }), showBalanceInFiat: "USD", tokenAddress: tokenAddress })] })) : ((0, jsx_runtime_1.jsx)(balance_js_1.AccountBalance, { chain: walletChain, fallbackComponent: (0, jsx_runtime_1.jsx)(Skeleton_js_1.Skeleton, { height: index_js_1.fontSize.xs, width: "70px" }), formatFn: detailsBtn_formatTokenBalanceForButton, loadingComponent: (0, jsx_runtime_1.jsx)(Skeleton_js_1.Skeleton, { height: index_js_1.fontSize.xs, width: "70px" }), tokenAddress: tokenAddress })) })] })] }));
};
exports.ConnectedWalletDetails = ConnectedWalletDetails;
/**
 * @internal Exported for tests
 */
function detailsBtn_formatFiatBalanceForButton(props) {
    return ` (${(0, account_js_1.formatAccountFiatBalance)({ ...props, decimals: 0 })})`;
}
/**
 * @internal Exported for test
 */
function detailsBtn_formatTokenBalanceForButton(props) {
    return `${(0, account_js_1.formatAccountTokenBalance)({ ...props, decimals: props.balance < 1 ? 5 : 4 })}`;
}
/**
 * @internal Exported for tests only
 */
function DetailsModal(props) {
    const [screen, setScreen] = (0, react_1.useState)("main");
    const { disconnect } = (0, useDisconnect_js_1.useDisconnect)();
    const [isOpen, setIsOpen] = (0, react_1.useState)(true);
    const { client, locale } = props;
    const walletChain = (0, useActiveWalletChain_js_1.useActiveWalletChain)();
    const activeAccount = (0, useActiveAccount_js_1.useActiveAccount)();
    const theme = (0, CustomThemeProvider_js_1.parseTheme)(props.theme);
    const activeWallet = (0, useActiveWallet_js_1.useActiveWallet)();
    const chainFaucetsQuery = (0, useChainQuery_js_1.useChainFaucets)(walletChain);
    const chainMetadataQuery = (0, useChainQuery_js_1.useChainMetadata)(walletChain);
    const disableSwitchChain = !activeWallet?.switchChain;
    const screenSetup = (0, screen_js_1.useSetupScreen)({
        size: "compact",
        wallets: activeWallet ? [activeWallet] : [],
        welcomeScreen: undefined,
    });
    const closeModal = (0, react_1.useCallback)(() => {
        setIsOpen(false);
        (0, constants_js_1.onModalUnmount)(() => {
            props.closeModal();
        });
    }, [props.closeModal]);
    function handleDisconnect(info) {
        setIsOpen(false);
        props.closeModal();
        props.onDisconnect(info);
    }
    (0, react_1.useEffect)(() => {
        if (!activeAccount) {
            closeModal();
        }
    }, [activeAccount, closeModal]);
    const { hideSendFunds, hideReceiveFunds, hideBuyFunds } = props.detailsModal || {};
    const hideAllButtons = hideSendFunds && hideReceiveFunds && hideBuyFunds;
    const avatarContent = ((0, jsx_runtime_1.jsxs)(basic_js_1.Container, { style: {
            height: `${index_js_1.iconSize.xl}px`,
            position: "relative",
            width: `${index_js_1.iconSize.xl}px`,
        }, children: [(0, jsx_runtime_1.jsx)(basic_js_1.Container, { style: {
                    borderRadius: "100%",
                    height: "100%",
                    overflow: "hidden",
                    width: "100%",
                }, children: props.detailsModal?.connectedAccountAvatarUrl ? ((0, jsx_runtime_1.jsx)("img", { alt: "", src: props.detailsModal.connectedAccountAvatarUrl, style: {
                        height: "100%",
                        objectFit: "cover",
                        width: "100%",
                    } })) : (activeAccount && ((0, jsx_runtime_1.jsx)(avatar_js_1.AccountAvatar, { fallbackComponent: (0, jsx_runtime_1.jsx)(blobbie_js_1.AccountBlobbie, { size: Number(index_js_1.iconSize.xxl) }), loadingComponent: (0, jsx_runtime_1.jsx)(blobbie_js_1.AccountBlobbie, { size: Number(index_js_1.iconSize.xxl) }), style: {
                        height: "100%",
                        objectFit: "cover",
                        width: "100%",
                    } }))) }), !props.detailsModal?.hideSwitchWallet ? ((0, jsx_runtime_1.jsx)(basic_js_1.Container, { style: {
                    bottom: -2,
                    position: "absolute",
                    right: -2,
                }, children: (0, jsx_runtime_1.jsx)(IconContainer_js_1.IconContainer, { padding: "4px", style: {
                        background: theme.colors.modalBg,
                    }, children: activeWallet && ((0, jsx_runtime_1.jsx)(WalletImage_js_1.WalletImage, { client: client, id: activeWallet.id, size: "12", style: { borderRadius: 0 } })) }) })) : null] }));
    let content = ((0, jsx_runtime_1.jsxs)("div", { className: `${TW_CONNECTED_WALLET}__default_modal_screen`, children: [(0, jsx_runtime_1.jsx)(Spacer_js_1.Spacer, { y: "xs" }), (0, jsx_runtime_1.jsxs)(basic_js_1.Container, { center: "y", flex: "row", gap: "sm", px: "lg", style: {
                    paddingBottom: hideAllButtons ? index_js_1.spacing.md : index_js_1.spacing.lg,
                    paddingTop: index_js_1.spacing.lg,
                }, children: [props.detailsModal?.hideSwitchWallet ? (avatarContent) : ((0, jsx_runtime_1.jsx)(Tooltip_js_1.ToolTip, { tip: "Switch wallet", children: (0, jsx_runtime_1.jsx)("div", { onClick: () => {
                                setScreen("wallet-manager");
                            }, onKeyDown: (e) => {
                                if (e.key === "w") {
                                    setScreen("wallet-manager");
                                }
                            }, style: {
                                cursor: "pointer",
                            }, children: avatarContent }) })), (0, jsx_runtime_1.jsxs)(basic_js_1.Container, { flex: "column", gap: "3xs", children: [(0, jsx_runtime_1.jsxs)("div", { style: {
                                    alignItems: "center",
                                    display: "flex",
                                    gap: index_js_1.spacing.xxs,
                                }, children: [props.detailsModal?.connectedAccountName ? ((0, jsx_runtime_1.jsx)(text_js_1.Text, { color: "primaryText", size: "md", weight: 500, children: props.detailsModal.connectedAccountName })) : ((0, jsx_runtime_1.jsx)(text_js_1.Text, { color: "primaryText", size: "md", weight: 500, children: (0, jsx_runtime_1.jsx)(name_js_1.AccountName, { fallbackComponent: (0, jsx_runtime_1.jsx)(address_js_2.AccountAddress, { formatFn: address_js_1.shortenAddress }), loadingComponent: (0, jsx_runtime_1.jsx)(address_js_2.AccountAddress, { formatFn: address_js_1.shortenAddress }) }) })), (0, jsx_runtime_1.jsx)(buttons_js_1.IconButton, { children: (0, jsx_runtime_1.jsx)(CopyIcon_js_1.CopyIcon, { text: activeAccount?.address || "", tip: locale.copyAddress }) })] }), (0, jsx_runtime_1.jsx)(InAppWalletUserInfo, { client: client, locale: locale })] })] }), !hideAllButtons && ((0, jsx_runtime_1.jsxs)(jsx_runtime_1.Fragment, { children: [(0, jsx_runtime_1.jsx)(basic_js_1.Container, { px: "lg", children: (0, jsx_runtime_1.jsxs)(basic_js_1.Container, { style: {
                                display: "flex",
                                gap: index_js_1.spacing.xs,
                            }, children: [!hideSendFunds && ((0, jsx_runtime_1.jsxs)(buttons_js_1.Button, { onClick: () => {
                                        setScreen("send");
                                    }, style: {
                                        alignItems: "center",
                                        display: "flex",
                                        flex: 1,
                                        fontSize: index_js_1.fontSize.sm,
                                        gap: index_js_1.spacing.xs,
                                        padding: index_js_1.spacing.sm,
                                    }, variant: "outline", children: [(0, jsx_runtime_1.jsx)(basic_js_1.Container, { center: "both", color: "secondaryText", flex: "row", children: (0, jsx_runtime_1.jsx)(react_icons_1.PaperPlaneIcon, { height: index_js_1.iconSize.sm, style: {
                                                    transform: "translateY(-10%) rotate(-45deg) ",
                                                }, width: index_js_1.iconSize.sm }) }), locale.send] })), !hideReceiveFunds && ((0, jsx_runtime_1.jsxs)(buttons_js_1.Button, { onClick: () => {
                                        setScreen("receive");
                                    }, style: {
                                        alignItems: "center",
                                        display: "flex",
                                        flex: 1,
                                        fontSize: index_js_1.fontSize.sm,
                                        gap: index_js_1.spacing.xs,
                                        padding: index_js_1.spacing.sm,
                                    }, variant: "outline", children: [(0, jsx_runtime_1.jsx)(basic_js_1.Container, { center: "both", color: "secondaryText", flex: "row", children: (0, jsx_runtime_1.jsx)(react_icons_1.PinBottomIcon, { height: index_js_1.iconSize.sm, width: index_js_1.iconSize.sm }) }), locale.receive] })), !hideBuyFunds &&
                                    chainMetadataQuery.data &&
                                    !chainMetadataQuery.data.testnet && ((0, jsx_runtime_1.jsxs)(buttons_js_1.Button, { onClick: () => {
                                        (0, pay_js_1.trackPayEvent)({
                                            client: client,
                                            event: "details_modal_buy_click",
                                            walletAddress: activeAccount?.address,
                                            walletType: activeWallet?.id,
                                        });
                                        setScreen("buy");
                                    }, style: {
                                        alignItems: "center",
                                        display: "flex",
                                        flex: 1,
                                        fontSize: index_js_1.fontSize.sm,
                                        gap: index_js_1.spacing.xs,
                                        padding: index_js_1.spacing.sm,
                                    }, variant: "outline", children: [(0, jsx_runtime_1.jsx)(basic_js_1.Container, { center: "both", color: "secondaryText", flex: "row", children: (0, jsx_runtime_1.jsx)(react_icons_1.PlusIcon, { height: index_js_1.iconSize.sm, width: index_js_1.iconSize.sm }) }), locale.buy] }))] }) }), (0, jsx_runtime_1.jsx)(Spacer_js_1.Spacer, { y: "md" })] })), (0, jsx_runtime_1.jsxs)(basic_js_1.Container, { px: "md", children: [(0, jsx_runtime_1.jsxs)(basic_js_1.Container, { flex: "column", style: {
                            gap: "1px",
                        }, children: [(0, jsx_runtime_1.jsx)(NetworkSwitcherButton, { client: props.client, disableSwitchChain: disableSwitchChain, displayBalanceToken: props.displayBalanceToken, setScreen: () => setScreen("network-switcher"), showBalanceInFiat: props.detailsModal?.showBalanceInFiat }), (0, jsx_runtime_1.jsxs)(MenuButton_js_1.MenuButton, { onClick: () => {
                                    setScreen("transactions");
                                }, style: {
                                    fontSize: index_js_1.fontSize.sm,
                                }, children: [(0, jsx_runtime_1.jsx)(react_icons_1.TextAlignJustifyIcon, { height: index_js_1.iconSize.md, width: index_js_1.iconSize.md }), (0, jsx_runtime_1.jsx)(basic_js_1.Container, { center: "y", flex: "row", gap: "xs", children: (0, jsx_runtime_1.jsx)(text_js_1.Text, { color: "primaryText", children: locale.transactions }) })] }), (props.assetTabs === undefined || props.assetTabs.length > 0) && ((0, jsx_runtime_1.jsxs)(MenuButton_js_1.MenuButton, { onClick: () => {
                                    setScreen("view-assets");
                                }, style: {
                                    fontSize: index_js_1.fontSize.sm,
                                }, children: [(0, jsx_runtime_1.jsx)(CoinsIcon_js_1.CoinsIcon, { size: index_js_1.iconSize.md }), (0, jsx_runtime_1.jsx)(text_js_1.Text, { color: "primaryText", children: locale.viewFunds.viewAssets })] })), (0, jsx_runtime_1.jsxs)(MenuButton_js_1.MenuButton, { onClick: () => {
                                    setScreen("manage-wallet");
                                }, style: {
                                    fontSize: index_js_1.fontSize.sm,
                                }, children: [(0, jsx_runtime_1.jsx)(OutlineWalletIcon_js_1.OutlineWalletIcon, { size: index_js_1.iconSize.md }), (0, jsx_runtime_1.jsx)(text_js_1.Text, { color: "primaryText", children: props.locale.manageWallet.title })] }), (props.detailsModal?.showTestnetFaucet ?? false) &&
                                (chainFaucetsQuery.faucets.length > 0 ||
                                    walletChain?.id === LocalhostChainId) && ((0, jsx_runtime_1.jsxs)(MenuButton_js_1.MenuLink, { as: "a", href: chainFaucetsQuery.faucets ? chainFaucetsQuery.faucets[0] : "#", style: {
                                    color: "inherit",
                                    textDecoration: "none",
                                }, target: "_blank", children: [(0, jsx_runtime_1.jsx)(basic_js_1.Container, { center: "both", color: "secondaryText", flex: "row", children: (0, jsx_runtime_1.jsx)(FundsIcon_js_1.FundsIcon, { size: index_js_1.iconSize.md }) }), locale.requestTestnetFunds] })), props.detailsModal?.footer && ((0, jsx_runtime_1.jsx)(props.detailsModal.footer, { close: closeModal }))] }), (0, jsx_runtime_1.jsx)(Spacer_js_1.Spacer, { y: "md" })] }), props.detailsModal?.hideDisconnect !== true && ((0, jsx_runtime_1.jsxs)(basic_js_1.Container, { children: [(0, jsx_runtime_1.jsx)(basic_js_1.Line, {}), (0, jsx_runtime_1.jsx)(Spacer_js_1.Spacer, { y: "sm" }), (0, jsx_runtime_1.jsx)(basic_js_1.Container, { px: "md", children: (0, jsx_runtime_1.jsxs)(MenuButton_js_1.MenuButton, { "data-variant": "danger", onClick: () => {
                                if (activeWallet && activeAccount) {
                                    disconnect(activeWallet);
                                    handleDisconnect({
                                        account: activeAccount,
                                        wallet: activeWallet,
                                    });
                                }
                            }, type: "button", children: [(0, jsx_runtime_1.jsx)(react_icons_1.ExitIcon, { height: index_js_1.iconSize.md, width: index_js_1.iconSize.md }), (0, jsx_runtime_1.jsx)(text_js_1.Text, { color: "primaryText", children: locale.disconnectWallet })] }) }), (0, jsx_runtime_1.jsx)(Spacer_js_1.Spacer, { y: "sm" })] }))] }));
    if (screen === "transactions") {
        content = ((0, jsx_runtime_1.jsx)(TransactionsScreen_js_1.TransactionsScreen, { client: client, closeModal: closeModal, locale: locale, onBack: () => setScreen("main"), setScreen: setScreen, title: locale.buy }));
    }
    if (screen === "wallet-manager" &&
        activeAccount &&
        walletChain &&
        activeWallet) {
        content = ((0, jsx_runtime_1.jsx)(WalletManagerScreen_js_1.WalletManagerScreen, { accountAbstraction: props.connectOptions?.accountAbstraction, activeAccount: activeAccount, activeChain: walletChain, activeWallet: activeWallet, appMetadata: props.connectOptions?.appMetadata, chain: props.connectOptions?.chain, chains: props.connectOptions?.chains, client: client, connectLocale: locale, hiddenWallets: props.connectOptions?.hiddenWallets, onBack: () => setScreen("main"), recommendedWallets: props.connectOptions?.recommendedWallets, showAllWallets: !!props.connectOptions?.showAllWallets, walletConnect: props.connectOptions?.walletConnect, wallets: props.connectOptions?.wallets }));
    }
    if (screen === "network-switcher") {
        content = ((0, jsx_runtime_1.jsx)(NetworkSelector_js_1.NetworkSelectorContent
        // add currently connected chain to the list of chains if it's not already in the list
        , { 
            // add currently connected chain to the list of chains if it's not already in the list
            chains: walletChain &&
                props.chains.find((c) => c.id === walletChain.id) === undefined
                ? [walletChain, ...props.chains]
                : props.chains, client: client, closeModal: closeModal, connectLocale: locale, networkSelector: props.detailsModal?.networkSelector, onBack: () => {
                setScreen("main");
            } }));
    }
    else if (screen === "view-assets") {
        content = ((0, jsx_runtime_1.jsx)(ViewAssets_js_1.ViewAssets, { assetTabs: props.detailsModal?.assetTabs, client: client, connectLocale: locale, onBack: () => {
                setScreen("main");
            }, setScreen: setScreen, supportedNFTs: props.supportedNFTs, supportedTokens: props.supportedTokens, theme: props.theme }));
    }
    else if (screen === "view-nfts") {
        content = ((0, jsx_runtime_1.jsx)(ViewNFTs_js_1.ViewNFTs, { client: client, connectLocale: locale, onBack: () => {
                setScreen("main");
            }, supportedNFTs: props.supportedNFTs, theme: props.theme }));
    }
    else if (screen === "view-tokens") {
        content = ((0, jsx_runtime_1.jsx)(ViewTokens_js_1.ViewTokens, { client: client, connectLocale: locale, onBack: () => {
                setScreen("main");
            }, supportedTokens: props.supportedTokens }));
    }
    else if (screen === "private-key") {
        content = ((0, jsx_runtime_1.jsx)(PrivateKey_js_1.PrivateKey, { client: client, connectLocale: locale, onBack: () => {
                setScreen("manage-wallet");
            }, theme: props.theme, wallet: activeWallet }));
    }
    else if (screen === "manage-wallet") {
        content = ((0, jsx_runtime_1.jsx)(ManageWalletScreen_js_1.ManageWalletScreen, { client: client, closeModal: closeModal, locale: locale, onBack: () => {
                setScreen("main");
            }, manageWallet: props.detailsModal?.manageWallet, setScreen: setScreen }));
    }
    else if (screen === "wallet-connect-receiver") {
        content = ((0, jsx_runtime_1.jsx)(WalletConnectReceiverScreen_js_1.WalletConnectReceiverScreen, { chains: props.chains, client: client, onBack: () => {
                setScreen("manage-wallet");
            } }));
    }
    else if (screen === "linked-profiles") {
        content = ((0, jsx_runtime_1.jsx)(LinkedProfilesScreen_js_1.LinkedProfilesScreen, { client: client, locale: locale, onBack: () => setScreen("manage-wallet"), setScreen: setScreen }));
    }
    else if (screen === "link-profile") {
        content = ((0, jsx_runtime_1.jsx)(LinkProfileScreen_js_1.LinkProfileScreen, { client: client, locale: locale, onBack: () => {
                setScreen("linked-profiles");
            }, walletConnect: props.connectOptions?.walletConnect }));
    }
    // send funds
    else if (screen === "send") {
        content = ((0, jsx_runtime_1.jsx)(SendFunds_js_1.SendFunds, { client: client, connectLocale: locale, onBack: () => {
                setScreen("main");
            }, supportedTokens: props.supportedTokens }));
    }
    // receive funds
    else if (screen === "receive") {
        content = ((0, jsx_runtime_1.jsx)(ReceiveFunds_js_1.ReceiveFunds, { client: client, connectLocale: locale, onBack: () => {
                setScreen("main");
            }, walletId: activeWallet?.id }));
    }
    // thirdweb pay
    else if (screen === "buy") {
        const requestedChainId = props.detailsModal?.payOptions?.prefillBuy?.chain?.id ||
            walletChain?.id ||
            props.chains[0]?.id ||
            1;
        content = ((0, jsx_runtime_1.jsx)(BuyWidget_js_1.BuyWidget, { amount: props.detailsModal?.payOptions?.prefillBuy?.amount || "0.01", chain: (0, utils_js_1.getCachedChain)(requestedChainId), client: client, hiddenWallets: props.detailsModal?.hiddenWallets, locale: locale.id, connectOptions: props.connectOptions, onCancel: () => setScreen("main"), onSuccess: () => setScreen("main"), supportedTokens: props.supportedTokens, theme: props.theme, style: {
                border: "none",
                borderRadius: index_js_1.radius.lg,
            }, tokenAddress: props.displayBalanceToken?.[Number(requestedChainId)] }));
    }
    return ((0, jsx_runtime_1.jsx)(CustomThemeProvider_js_1.CustomThemeProvider, { theme: props.theme, children: (0, jsx_runtime_1.jsx)(wallet_ui_states_provider_js_1.WalletUIStatesProvider, { isOpen: false, theme: props.theme, children: (0, jsx_runtime_1.jsx)(screen_js_1.ScreenSetupContext.Provider, { value: screenSetup, children: (0, jsx_runtime_1.jsx)(Modal_js_1.Modal, { open: isOpen, setOpen: (_open) => {
                        if (!_open) {
                            closeModal();
                            if (props.detailsModal?.onClose) {
                                props.detailsModal?.onClose(screen);
                            }
                        }
                    }, size: "compact", children: activeAccount?.address && ((0, jsx_runtime_1.jsx)(provider_js_1.AccountProvider, { address: activeAccount.address, client: client, children: content })) }) }) }) }));
}
/**
 * When this button is clicked, it will switch to the screen where users
 * can select a chain to switch to.
 * @internal
 */
function NetworkSwitcherButton(props) {
    const { disableSwitchChain, setScreen, showBalanceInFiat, client } = props;
    const walletChain = (0, useActiveWalletChain_js_1.useActiveWalletChain)();
    if (!walletChain) {
        return null;
    }
    return ((0, jsx_runtime_1.jsxs)(MenuButton_js_1.MenuButton, { className: "tw-internal-network-switcher-button", "data-variant": "primary", disabled: disableSwitchChain, onClick: () => {
            setScreen("network-switcher");
        }, type: "button", children: [(0, jsx_runtime_1.jsxs)(provider_js_2.ChainProvider, { chain: walletChain, children: [(0, jsx_runtime_1.jsx)("div", { style: {
                            alignItems: "center",
                            display: "flex",
                            position: "relative",
                        }, children: (0, jsx_runtime_1.jsxs)(basic_js_1.Container, { style: {
                                alignItems: "center",
                                display: "flex",
                                flexShrink: 0,
                                position: "relative",
                            }, children: [(0, jsx_runtime_1.jsx)(icon_js_1.ChainIcon, { client: client, fallbackComponent: (0, jsx_runtime_1.jsx)("img", { alt: "", src: fallbackChainIcon_js_1.fallbackChainIcon, style: {
                                            height: `${index_js_1.iconSize.md}px`,
                                            width: `${index_js_1.iconSize.md}px`,
                                        } }), loadingComponent: (0, jsx_runtime_1.jsx)(Skeleton_js_1.Skeleton, { height: `${index_js_1.iconSize.md}px`, width: `${index_js_1.iconSize.md}px` }), style: {
                                        height: `${index_js_1.iconSize.md}px`,
                                        width: `${index_js_1.iconSize.md}px`,
                                    } }), (0, jsx_runtime_1.jsx)(ChainActiveDot_js_1.ChainActiveDot, { className: "tw-chain-active-dot-details-button" })] }) }), (0, jsx_runtime_1.jsxs)(text_js_1.Text, { color: "primaryText", multiline: true, size: "md", children: [(0, jsx_runtime_1.jsx)(name_js_2.ChainName, { fallbackComponent: (0, jsx_runtime_1.jsxs)("span", { children: ["Unknown chain #", walletChain?.id] }), loadingComponent: (0, jsx_runtime_1.jsx)(Skeleton_js_1.Skeleton, { height: "16px", width: "150px" }) }), (0, jsx_runtime_1.jsx)(text_js_1.Text, { color: "secondaryText", size: "xs", children: showBalanceInFiat ? ((0, jsx_runtime_1.jsxs)(jsx_runtime_1.Fragment, { children: [(0, jsx_runtime_1.jsx)(balance_js_1.AccountBalance, { chain: walletChain, fallbackComponent: (0, jsx_runtime_1.jsx)(Skeleton_js_1.Skeleton, { height: "1em", width: "70px" }), formatFn: (props) => (0, account_js_1.formatAccountTokenBalance)({ ...props, decimals: 7 }), loadingComponent: (0, jsx_runtime_1.jsx)(Skeleton_js_1.Skeleton, { height: "1em", width: "70px" }), tokenAddress: props.displayBalanceToken?.[Number(walletChain?.id)] }), " ", (0, jsx_runtime_1.jsx)(balance_js_1.AccountBalance, { chain: walletChain, formatFn: (props) => ` (${(0, account_js_1.formatAccountFiatBalance)({ ...props, decimals: 3 })})`, loadingComponent: (0, jsx_runtime_1.jsx)(Skeleton_js_1.Skeleton, { height: "1em", width: "30px" }), showBalanceInFiat: "USD", tokenAddress: props.displayBalanceToken?.[Number(walletChain?.id)] })] })) : ((0, jsx_runtime_1.jsx)(balance_js_1.AccountBalance, { chain: walletChain, fallbackComponent: (0, jsx_runtime_1.jsx)(Skeleton_js_1.Skeleton, { height: "1em", width: "100px" }), formatFn: (props) => (0, account_js_1.formatAccountTokenBalance)({ ...props, decimals: 7 }), loadingComponent: (0, jsx_runtime_1.jsx)(Skeleton_js_1.Skeleton, { height: "1em", width: "100px" }), tokenAddress: props.displayBalanceToken?.[Number(walletChain?.id)] })) })] })] }), (0, jsx_runtime_1.jsx)(exports.StyledChevronRightIcon, { height: index_js_1.iconSize.sm, style: {
                    flexShrink: 0,
                    marginLeft: "auto",
                }, width: index_js_1.iconSize.sm })] }));
}
const WalletInfoButton = /* @__PURE__ */ (0, elements_js_1.StyledButton)((_) => {
    const theme = (0, CustomThemeProvider_js_1.useCustomTheme)();
    return {
        all: "unset",
        "&:hover": {
            background: theme.colors.connectedButtonBgHover,
            transition: "background 250ms ease",
        },
        alignItems: "center",
        animation: `${animations_js_1.fadeInAnimation} 300ms ease`,
        background: theme.colors.connectedButtonBg,
        border: `1px solid ${theme.colors.borderColor}`,
        borderRadius: index_js_1.radius.md,
        boxSizing: "border-box",
        cursor: "pointer",
        display: "inline-flex",
        gap: index_js_1.spacing.xs,
        height: "50px",
        lineHeight: "normal",
        minWidth: "165px",
        overflow: "hidden",
        padding: index_js_1.spacing.xs,
        WebkitTapHighlightColor: "transparent",
    };
});
/**
 * @internal Export for tests
 */
exports.StyledChevronRightIcon = (0, styled_1.default)(
/* @__PURE__ */ react_icons_1.ChevronRightIcon)(() => {
    const theme = (0, CustomThemeProvider_js_1.useCustomTheme)();
    return {
        color: theme.colors.secondaryText,
    };
});
/**
 * @internal Exported for test
 */
function ConnectedToSmartWallet(props) {
    const activeAccount = (0, useActiveAccount_js_1.useActiveAccount)();
    const activeWallet = (0, useActiveWallet_js_1.useActiveWallet)();
    const isSW = (0, is_smart_wallet_js_1.isSmartWallet)(activeWallet);
    const chain = (0, useActiveWalletChain_js_1.useActiveWalletChain)();
    const { client, connectLocale: locale } = props;
    const [isSmartWalletDeployed, setIsSmartWalletDeployed] = (0, react_1.useState)(false);
    (0, react_1.useEffect)(() => {
        if (activeAccount && isSW && activeAccount.address && chain) {
            const contract = (0, contract_js_1.getContract)({
                address: activeAccount.address,
                chain,
                client,
            });
            (0, is_contract_deployed_js_1.isContractDeployed)(contract).then((isDeployed) => {
                setIsSmartWalletDeployed(isDeployed);
            });
        }
        else {
            setIsSmartWalletDeployed(false);
        }
    }, [activeAccount, chain, client, isSW]);
    const content = ((0, jsx_runtime_1.jsx)(basic_js_1.Container, { center: "y", flex: "row", gap: "3xs", children: (0, jsx_runtime_1.jsx)(text_js_1.Text, { color: "secondaryText", size: "xs", weight: 400, children: locale.connectedToSmartWallet }) }));
    if (chain && activeAccount && isSW) {
        return ((0, jsx_runtime_1.jsx)(jsx_runtime_1.Fragment, { children: isSmartWalletDeployed ? ((0, jsx_runtime_1.jsx)(text_js_1.Link, { color: "secondaryText", hoverColor: "primaryText", href: `https://thirdweb.com/${chain.id}/${activeAccount.address}/account`, size: "sm", target: "_blank", children: content })) : ((0, jsx_runtime_1.jsxs)(text_js_1.Text, { size: "sm", children: [" ", content] })) }));
    }
    return null;
}
/**
 * @internal Exported for tests
 */
function InAppWalletUserInfo(props) {
    const { client, locale } = props;
    const account = (0, useActiveAccount_js_1.useActiveAccount)();
    const activeWallet = (0, useActiveWallet_js_1.useActiveWallet)();
    const adminWallet = (0, useAdminWallet_js_1.useAdminWallet)();
    const { data: walletInfo } = (0, wallet_js_1.useWalletInfo)(activeWallet?.id);
    const isSW = (0, is_smart_wallet_js_1.isSmartWallet)(activeWallet);
    const { data: walletName } = (0, react_query_1.useQuery)({
        enabled: !!activeWallet?.id && !!walletInfo,
        queryFn: async () => {
            const lastAuthProvider = await (0, storage_js_1.getLastAuthProvider)(webStorage_js_1.webLocalStorage);
            if (lastAuthProvider === "guest") {
                return "Guest";
            }
            if (lastAuthProvider &&
                (activeWallet?.id === "inApp" || activeWallet?.id === "smart") &&
                types_js_1.socialAuthOptions.includes(lastAuthProvider)) {
                return (lastAuthProvider.slice(0, 1).toUpperCase() + lastAuthProvider.slice(1));
            }
            return walletInfo?.name;
        },
        queryKey: [
            "wallet-name",
            { walletAddress: account?.address, walletId: activeWallet?.id },
        ],
    });
    const userInfoQuery = (0, react_query_1.useQuery)({
        enabled: !!adminWallet,
        queryFn: async () => {
            const isInAppWallet = adminWallet &&
                (adminWallet.id === "inApp" || adminWallet.id.startsWith("ecosystem."));
            if (!isInAppWallet) {
                return null;
            }
            let ecosystem;
            if ((0, is_ecosystem_wallet_js_1.isEcosystemWallet)(adminWallet)) {
                const ecosystemWallet = adminWallet;
                const partnerId = ecosystemWallet.getConfig()?.partnerId;
                ecosystem = {
                    id: ecosystemWallet.id,
                    partnerId,
                };
            }
            const { getUserEmail, getUserPhoneNumber } = await Promise.resolve().then(() => require("../../../../wallets/in-app/web/lib/auth/index.js"));
            const [email, phone] = await Promise.all([
                getUserEmail({
                    client: client,
                    ecosystem,
                }),
                getUserPhoneNumber({
                    client: client,
                    ecosystem,
                }),
            ]);
            return email || phone || null;
        },
        queryKey: ["in-app-wallet-user", client, account?.address],
    });
    if (!userInfoQuery.data && isSW) {
        return (0, jsx_runtime_1.jsx)(ConnectedToSmartWallet, { client: client, connectLocale: locale });
    }
    if (userInfoQuery.data || walletName) {
        return ((0, jsx_runtime_1.jsx)(text_js_1.Text, { size: "xs", weight: 400, children: userInfoQuery.data || walletName }));
    }
    return ((0, jsx_runtime_1.jsx)(Skeleton_js_1.Skeleton, { className: "InAppWalletUserInfo__skeleton", height: "10px", width: "50px" }));
}
/**
 * @internal Exported for tests
 */
function SwitchNetworkButton(props) {
    const switchChain = (0, useSwitchActiveWalletChain_js_1.useSwitchActiveWalletChain)();
    const [switching, setSwitching] = (0, react_1.useState)(false);
    const locale = props.connectLocale;
    const switchNetworkBtnTitle = props.switchNetworkBtnTitle ?? locale.switchNetwork;
    return ((0, jsx_runtime_1.jsx)(buttons_js_1.Button, { "aria-label": switching ? locale.switchingNetwork : undefined, className: `tw-connect-wallet--switch-network ${props.className || ""}`, "data-is-loading": switching, "data-test": "switch-network-button", disabled: switching, onClick: async () => {
            setSwitching(true);
            try {
                await switchChain(props.targetChain);
            }
            catch (e) {
                console.error(e);
            }
            setSwitching(false);
        }, style: {
            minWidth: "140px",
            ...props.style,
        }, type: "button", variant: "primary", children: switching ? ((0, jsx_runtime_1.jsx)(Spinner_js_1.Spinner, { color: "primaryButtonText", size: "sm" })) : (switchNetworkBtnTitle) }));
}
/**
 * Hook to open the Wallet Details Modal that shows various information about the connected wallet and allows users to perform various actions like sending funds, receiving funds, switching networks, Buying tokens, etc.
 *
 * @example
 * ### Basic usage
 * ```tsx
 * import { createThirdwebClient } from "thirdweb";
 * import { useWalletDetailsModal } from "thirdweb/react";
 *
 * const client = createThirdwebClient({
 *  clientId: "<your_client_id>",
 * });
 *
 * function Example() {
 *   const detailsModal = useWalletDetailsModal();
 *
 *   function handleClick() {
 *      detailsModal.open({ client, theme: 'light' });
 *   }
 *
 *   return <button onClick={handleClick}> Show Wallet Details </button>
 * }
 * ```
 *
 * ### Callback for when the modal is closed
 * ```tsx
 * detailsModal.open({
 *   client,
 *   onClose: (screen: string) => console.log({ screen })
 * });
 * ```
 *
 * @wallet
 */
function useWalletDetailsModal() {
    const account = (0, useActiveAccount_js_1.useActiveAccount)();
    const setRootEl = (0, react_1.useContext)(RootElementContext_js_1.SetRootElementContext);
    function closeModal() {
        setRootEl(null);
    }
    function openModal(props) {
        if (!account) {
            throw new Error("Wallet is not connected.");
        }
        (0, getConnectLocale_js_1.getConnectLocale)(props.locale || "en_US")
            .then((locale) => {
            setRootEl((0, jsx_runtime_1.jsx)(DetailsModal, { chains: props.chains || [], client: props.client, closeModal: closeModal, connectOptions: props.connectOptions, detailsModal: {
                    showBalanceInFiat: props.showBalanceInFiat,
                    hiddenWallets: props.hiddenWallets,
                    manageWallet: props.manageWallet,
                    assetTabs: props.assetTabs,
                    connectedAccountAvatarUrl: props.connectedAccountAvatarUrl,
                    connectedAccountName: props.connectedAccountName,
                    footer: props.footer,
                    hideBuyFunds: props.hideBuyFunds,
                    hideDisconnect: props.hideDisconnect,
                    hideReceiveFunds: props.hideReceiveFunds,
                    hideSendFunds: props.hideSendFunds,
                    hideSwitchWallet: props.hideSwitchWallet,
                    networkSelector: props.networkSelector,
                    onClose: props.onClose,
                    payOptions: props.payOptions,
                    showTestnetFaucet: props.showTestnetFaucet,
                }, displayBalanceToken: props.displayBalanceToken, locale: locale, onDisconnect: (info) => {
                    props.onDisconnect?.(info);
                    closeModal();
                }, supportedNFTs: props.supportedNFTs, supportedTokens: props.supportedTokens, theme: props.theme || "dark" }));
        })
            .catch(() => {
            closeModal();
        });
    }
    return {
        open: openModal,
    };
}
//# sourceMappingURL=Details.js.map