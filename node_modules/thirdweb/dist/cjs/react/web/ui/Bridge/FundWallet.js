"use strict";
/** biome-ignore-all lint/a11y/useSemanticElements: FIXME */
"use client";
Object.defineProperty(exports, "__esModule", { value: true });
exports.FundWallet = FundWallet;
const jsx_runtime_1 = require("react/jsx-runtime");
const react_1 = require("react");
const address_js_1 = require("../../../../utils/address.js");
const formatNumber_js_1 = require("../../../../utils/formatNumber.js");
const CustomThemeProvider_js_1 = require("../../../core/design-system/CustomThemeProvider.js");
const index_js_1 = require("../../../core/design-system/index.js");
const useActiveAccount_js_1 = require("../../../core/hooks/wallets/useActiveAccount.js");
const ConnectButton_js_1 = require("../ConnectWallet/ConnectButton.js");
const OutlineWalletIcon_js_1 = require("../ConnectWallet/icons/OutlineWalletIcon.js");
const PoweredByTW_js_1 = require("../ConnectWallet/PoweredByTW.js");
const WalletRow_js_1 = require("../ConnectWallet/screens/Buy/swap/WalletRow.js");
const formatTokenBalance_js_1 = require("../ConnectWallet/screens/formatTokenBalance.js");
const basic_js_1 = require("../components/basic.js");
const buttons_js_1 = require("../components/buttons.js");
const formElements_js_1 = require("../components/formElements.js");
const Spacer_js_1 = require("../components/Spacer.js");
const text_js_1 = require("../components/text.js");
const TokenAndChain_js_1 = require("./common/TokenAndChain.js");
const WithHeader_js_1 = require("./common/WithHeader.js");
function FundWallet({ client, receiverAddress, uiOptions, onContinue, presetOptions = [5, 10, 20], connectOptions, showThirdwebBranding = true, }) {
    const [amount, setAmount] = (0, react_1.useState)(uiOptions.initialAmount ?? "");
    const theme = (0, CustomThemeProvider_js_1.useCustomTheme)();
    const account = (0, useActiveAccount_js_1.useActiveAccount)();
    const receiver = receiverAddress ?? account?.address;
    const handleAmountChange = (inputValue) => {
        let processedValue = inputValue;
        // Replace comma with period if it exists
        processedValue = processedValue.replace(",", ".");
        if (processedValue.startsWith(".")) {
            processedValue = `0${processedValue}`;
        }
        const numValue = Number(processedValue);
        if (Number.isNaN(numValue)) {
            return;
        }
        if (processedValue.startsWith("0") && !processedValue.startsWith("0.")) {
            setAmount(processedValue.slice(1));
        }
        else {
            setAmount(processedValue);
        }
    };
    const getAmountFontSize = () => {
        const length = amount.length;
        if (length > 12)
            return index_js_1.fontSize.md;
        if (length > 8)
            return index_js_1.fontSize.lg;
        return index_js_1.fontSize.xl;
    };
    const isValidAmount = amount && Number(amount) > 0;
    const inputRef = (0, react_1.useRef)(null);
    const focusInput = () => {
        inputRef.current?.focus();
    };
    const handleQuickAmount = (usdAmount) => {
        const price = uiOptions.destinationToken.prices[uiOptions.currency || "USD"] || 0;
        if (price === 0) {
            return;
        }
        // Convert USD amount to token amount using token price
        const tokenAmount = usdAmount / price;
        // Format to reasonable decimal places (up to 6 decimals, remove trailing zeros)
        const formattedAmount = (0, formatNumber_js_1.numberToPlainString)(Number.parseFloat(tokenAmount.toFixed(6)));
        setAmount(formattedAmount);
    };
    return ((0, jsx_runtime_1.jsxs)(WithHeader_js_1.WithHeader, { client: client, defaultTitle: `Buy ${uiOptions.destinationToken.symbol}`, uiOptions: uiOptions, children: [(0, jsx_runtime_1.jsxs)(basic_js_1.Container, { flex: "column", children: [(0, jsx_runtime_1.jsxs)(basic_js_1.Container, { center: "both", flex: "row", gap: "3xs", p: "md", style: {
                            backgroundColor: theme.colors.tertiaryBg,
                            border: `1px solid ${theme.colors.borderColor}`,
                            borderRadius: index_js_1.radius.md,
                            flexWrap: "nowrap",
                        }, children: [(0, jsx_runtime_1.jsx)(TokenAndChain_js_1.TokenAndChain, { client: client, size: "xl", token: uiOptions.destinationToken }), (0, jsx_runtime_1.jsxs)(basic_js_1.Container, { center: "x", expand: true, flex: "column", gap: "3xs", style: {
                                    alignItems: "flex-end",
                                    justifyContent: "flex-end",
                                }, children: [(0, jsx_runtime_1.jsx)("div", { onClick: focusInput, onKeyDown: (e) => {
                                            if (e.key === "Enter" || e.key === " ") {
                                                e.preventDefault();
                                                focusInput();
                                            }
                                        }, role: "button", style: { cursor: "text" }, tabIndex: 0, children: (0, jsx_runtime_1.jsx)(basic_js_1.Container, { center: "y", flex: "row", gap: "xs", style: {
                                                flexWrap: "nowrap",
                                                justifyContent: "flex-end",
                                            }, children: (0, jsx_runtime_1.jsx)(formElements_js_1.Input, { "data-placeholder": amount === "", inputMode: "decimal", onChange: (e) => {
                                                    handleAmountChange(e.target.value);
                                                }, onClick: (e) => {
                                                    // put cursor at the end of the input
                                                    if (amount === "") {
                                                        e.currentTarget.setSelectionRange(e.currentTarget.value.length, e.currentTarget.value.length);
                                                    }
                                                }, pattern: "^[0-9]*[.,]?[0-9]*$", placeholder: "0", ref: inputRef, style: {
                                                    border: "none",
                                                    boxShadow: "none",
                                                    fontSize: getAmountFontSize(),
                                                    fontWeight: 600,
                                                    padding: "0",
                                                    textAlign: "right",
                                                }, type: "text", value: amount || "0", variant: "transparent" }) }) }), (0, jsx_runtime_1.jsx)(basic_js_1.Container, { center: "both", flex: "row", style: { flexWrap: "nowrap", height: index_js_1.fontSize.lg }, children: (0, jsx_runtime_1.jsxs)(text_js_1.Text, { color: "secondaryText", size: "md", style: { textWrap: "nowrap" }, children: ["\u2248", " ", (0, formatTokenBalance_js_1.formatCurrencyAmount)(uiOptions.currency || "USD", Number(amount) *
                                                    (uiOptions.destinationToken.prices[uiOptions.currency || "USD"] || 0))] }) })] })] }), presetOptions && ((0, jsx_runtime_1.jsxs)(jsx_runtime_1.Fragment, { children: [(0, jsx_runtime_1.jsx)(Spacer_js_1.Spacer, { y: "md" }), (0, jsx_runtime_1.jsx)(basic_js_1.Container, { center: "x", flex: "row", gap: "xs", style: {
                                    justifyContent: "space-evenly",
                                }, children: presetOptions?.map((amount) => ((0, jsx_runtime_1.jsxs)(buttons_js_1.Button, { onClick: () => handleQuickAmount(Number(amount)), style: {
                                        backgroundColor: theme.colors.tertiaryBg,
                                        flex: 1,
                                        fontSize: index_js_1.fontSize.sm,
                                        padding: `${index_js_1.spacing.sm} ${index_js_1.spacing.md}`,
                                    }, variant: "outline", children: ["$", amount] }, amount))) })] })), (0, jsx_runtime_1.jsx)(Spacer_js_1.Spacer, { y: "md" }), (0, jsx_runtime_1.jsx)(basic_js_1.Container, { center: "y", color: "secondaryText", flex: "row", gap: "sm", px: "md", py: "sm", style: {
                            backgroundColor: theme.colors.tertiaryBg,
                            border: `1px solid ${theme.colors.borderColor}`,
                            borderRadius: index_js_1.radius.md,
                        }, children: receiver ? ((0, jsx_runtime_1.jsx)(WalletRow_js_1.WalletRow, { address: receiver, client: client, iconSize: "md", textSize: "sm" })) : ((0, jsx_runtime_1.jsxs)(jsx_runtime_1.Fragment, { children: [(0, jsx_runtime_1.jsx)(OutlineWalletIcon_js_1.OutlineWalletIcon, { size: index_js_1.iconSize.md }), (0, jsx_runtime_1.jsx)(text_js_1.Text, { color: "secondaryText", size: "sm", style: {
                                        flex: 1,
                                    }, children: "No Wallet Connected" })] })) })] }), (0, jsx_runtime_1.jsx)(Spacer_js_1.Spacer, { y: "lg" }), receiver ? ((0, jsx_runtime_1.jsx)(buttons_js_1.Button, { disabled: !isValidAmount, fullWidth: true, onClick: () => {
                    if (isValidAmount) {
                        onContinue(amount, uiOptions.destinationToken, (0, address_js_1.getAddress)(receiver));
                    }
                }, style: {
                    fontSize: index_js_1.fontSize.md,
                    padding: `${index_js_1.spacing.sm} ${index_js_1.spacing.md}`,
                }, variant: "primary", children: uiOptions.buttonLabel ||
                    `Buy ${amount} ${uiOptions.destinationToken.symbol}` })) : ((0, jsx_runtime_1.jsx)(ConnectButton_js_1.ConnectButton, { client: client, connectButton: {
                    label: uiOptions.buttonLabel ||
                        `Buy ${amount} ${uiOptions.destinationToken.symbol}`,
                }, theme: theme, ...connectOptions })), showThirdwebBranding ? ((0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsx)(Spacer_js_1.Spacer, { y: "md" }), (0, jsx_runtime_1.jsx)(PoweredByTW_js_1.PoweredByThirdweb, {})] })) : null, (0, jsx_runtime_1.jsx)(Spacer_js_1.Spacer, { y: "lg" })] }));
}
//# sourceMappingURL=FundWallet.js.map